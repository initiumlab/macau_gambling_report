!function(t){var tl;t.fn.scrollHandler=function(e){var i=(t.extend({},e),null),n={};n.targetScroll=0,n.headHeight=t("header").outerHeight(),n.screenh=screen.height,n.divHeight=t(this).outerHeight(),t(window).scroll(function(){var e=t(this).scrollTop()-n.headHeight,s=e/(n.divHeight-n.screenh)*100;e>t("h2:first").position().top-30||t(".scrollWrapper h3").text(""),i.each(function(){if(e+n.headHeight>=t(this).position().top){var i=t(this).data("title");return t(".scrollWrapper h3").text(i),t("#header ."+t(this).attr("id")).addClass("active").siblings(".active").removeClass("active"),t("#nav ."+t(this).attr("id")).addClass("active").siblings(".active").removeClass("active"),!1}}),t(".scroll-bar").css("width",s+"%")}),i=t(t(".section").get().reverse());var s=t(".scroll-bar");return s},t(document).ready(function(){function e(){t("#slider").slider("value",100*tl.progress())}function i(){var i=Math.floor(100*tl.progress()/15);o!=i&&(t("#timeline .marker li.on").removeClass("on"),t("#timeline .marker li:eq("+i+")").addClass("on"),t("#current_yr").text(l.find(".marker li:eq("+i+")").addClass("on").text()),o=i),tl.reversed()&&tl.progress()<=a?tl.pause():tl.reversed()||tl.progress()<a||tl.pause(),e()}t(".slider").slick({infinite:!0,fade:!0});var n="",s=t("#header").height(),r=t(window).width()<768?"mobile":"desktop";t(".slider").on("beforeChange",function(e,i,s,r){var o=r+1;n=t(".slider").slick("getSlick").$slides[r],t(".slide-count").find(".counter").text(o),t(".slide-title").html(t(n).data("title")+' <span class="slide-author">'+t(n).data("author")+"</span>")}),t(".slide-count").find(".total").text(t(".slider").slick("getSlick").$slides.length),t(".slide-count").find(".counter").text(1),n=t(".slider").slick("getSlick").$slides[0],t(".slide-title").html(t(n).data("title")+' <span class="slide-author">'+t(n).data("author")+"</span>"),t("#slider").slider({range:!1,min:0,max:100,step:.1,slide:function(t,e){tl.pause(),tl.progress(e.value/100)}}),TweenMax.to("#timeline .car",.15,{y:1,yoyo:!0,repeat:-1,ease:Power1.easeInOut}),tl=new TimelineLite({onComplete:function(){var e=t(window).height()-100;t("body").hasClass("scrollable")||(t("body").addClass("scrollable"),t("body").scrollHandler({}),t(window).trigger("scroll")),setTimeout(function(){var i=t(window).scrollTop();if(i<t("#intro").height()){var n="desktop"==r?e:"#pt0";t("body").scrollTo(n,800,{onAfter:function(){t(".scrolldown").animate({opacity:1},400)},offset:{top:-146}})}},400)}});var o=0,a=1,l=t("#timeline");"desktop"==r?(tl.fromTo("#timeline .car",6,{x:0},{x:750,ease:Power0.easeNone,onUpdate:i,onComplete:function(){}},"start"),tl.to(l.find(".bar span"),6,{width:881,ease:Power0.easeNone},"start"),tl.to(l.find(".yr2004"),.3,{opacity:1,ease:Power2.easeInOut},.6,"2004"),tl.to(l.find(".yr2006"),.3,{opacity:1,ease:Power2.easeInOut},2.1-.4,"2006"),tl.to(l.find(".yr2007:nth-child(odd)"),.3,{opacity:1,ease:Power2.easeInOut},3.1-.7,"2007"),tl.to(l.find(".yr2007:nth-child(even)"),.3,{opacity:1,ease:Power2.easeInOut},2.7,"2007"),tl.to(l.find(".yr2009"),.3,{opacity:1,ease:Power2.easeInOut},4.1-.4,"2009"),tl.to(l.find(".yr2011"),.3,{opacity:1,ease:Power2.easeInOut},5.1-.4,"2011"),tl.to(l.find(".yr2015"),.3,{opacity:1,ease:Power2.easeInOut},6.1-.4,"2015"),tl.timeScale(1.3),tl.pause()):(tl.fromTo(l.find(".car"),6,{x:0},{x:300,ease:Power0.easeNone,onUpdate:i,onComplete:function(){}},"start"),tl.to(l.find(".bar span"),6,{width:304,ease:Power0.easeNone},"start"),tl.to(l.find(".building"),6,{x:-1180,ease:Power0.easeNone},"start"),tl.to(l.find(".yr2004"),.3,{opacity:1,ease:Power2.easeInOut},.6,"2004"),tl.to(l.find(".yr2006"),.3,{opacity:1,ease:Power2.easeInOut},2.1-.4,"2006"),tl.to(l.find(".yr2007"),.3,{opacity:1,ease:Power2.easeInOut},2.5,"2007"),tl.to(l.find(".yr2009"),.3,{opacity:1,ease:Power2.easeInOut},4.1-.5,"2009"),tl.to(l.find(".yr2011"),.3,{opacity:1,ease:Power2.easeInOut},4.6,"2011"),tl.to(l.find(".yr2015"),.3,{opacity:1,ease:Power2.easeInOut},6.1-.7,"2015"),tl.pause()),t(window).load(function(){t("body").scrollTo(0,800),tl&&tl.resume();var e=videojs(document.getElementById("video_1"),{controls:!0,autoplay:!1,preload:"auto"},function(){});e.ready(function(){var e="desktop"==r?base_path+"20151016_MacauTaxi_rough-Initium 480p.mp4":base_path+"20151026_MacauTaxi-Initium 480p.mp4";t("#video_1 video").attr("src",e)})}).resize(function(){var e=t(window).width();768>e?t("body").addClass("m").removeClass("h"):t("body").removeClass("m").addClass("h"),t("#intro").css("height",t(window).height()-t("#header").height())}).trigger("resize"),t(document).delegate("body.h #header .sections a, #nav a","click",function(e){e.preventDefault(),t("#nav").hasClass("active")&&t(".m #header .sections a.active").trigger("click"),t("body").scrollTo(t(t(this).data("section")),800,{offset:{top:-1*s}})}).delegate("body.m #header .sections a","click",function(e){e.preventDefault(),t("#nav").toggleClass("active")}).delegate(".marker li","click",function(e){e.preventDefault(),a=16.6*t(this).index()/100,a<tl.progress()?tl.reverse():tl.play()}).delegate(".scrolldown","click",function(e){e.preventDefault(),t("body").scrollTo("#pt1",800)}),t(".responsive-image").responsImg({breakpoints:{desktop:768}})})}(jQuery);